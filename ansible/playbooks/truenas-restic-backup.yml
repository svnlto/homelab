---
# Setup Restic backup to Backblaze B2 for critical TrueNAS data.
# Secrets fetched from 1Password via .envrc (B2_KEY_ID, B2_APPLICATION_KEY, vault_restic_password).

- name: Setup Restic backup to Backblaze B2
  hosts: truenas_primary
  become: true

  vars:
    restic_repo: "b2:homelab-truenas-backup:/"
    restic_password: "{{ vault_restic_password }}"
    b2_account_id: "{{ vault_b2_account_id }}"
    b2_account_key: "{{ vault_b2_account_key }}"

  vars_files:
    - ../vars/restic_backups.yml

  roles:
    - role: truenas_restic_backup
