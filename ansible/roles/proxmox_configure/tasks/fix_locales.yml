---
# ==============================================================================
# Fix Locale Settings
# ==============================================================================
# Generates missing locales and sets system defaults

- name: Check if en_GB.UTF-8 locale is generated
  ansible.builtin.shell: |
    set -o pipefail
    locale -a | grep -q "en_GB.utf8"
  register: locale_check
  changed_when: false
  failed_when: false

- name: Generate en_GB.UTF-8 locale
  ansible.builtin.command: locale-gen en_GB.UTF-8
  when: locale_check.rc != 0
  changed_when: true

- name: Update system locale configuration
  ansible.builtin.copy:
    dest: /etc/default/locale
    content: |
      LANG=en_US.UTF-8
      LC_ALL=en_US.UTF-8
    mode: '0644'
    owner: root
    group: root
  when: locale_check.rc != 0
