---
# =============================================================================
# Task: Ensure /etc/hosts has correct IP for this node
# =============================================================================
# After IP changes (e.g., SFP+ migration), /etc/hosts can have stale entries.
# Proxmox cluster and SSL certs depend on hostname resolving to the correct IP.

- name: Ensure /etc/hosts has correct entry for this node
  ansible.builtin.lineinfile:
    path: /etc/hosts
    regexp: '^\d+\.\d+\.\d+\.\d+\s+{{ inventory_hostname }}\.lan\s+{{ inventory_hostname }}$'
    line: "{{ ansible_host }} {{ inventory_hostname }}.lan {{ inventory_hostname }}"
    state: present
