---
# =============================================================================
# Task: Configure Dell Fan Control
# =============================================================================
# Installs and configures IPMI-based fan speed control for Dell servers
# Automatically adjusts fan speed based on inlet temperature

- name: Install ipmitool
  ansible.builtin.apt:
    name: ipmitool
    state: present
    update_cache: true

- name: Deploy Dell fan control script
  ansible.builtin.template:
    src: dell-fan-control.sh.j2
    dest: /usr/local/bin/dell-fan-control.sh
    owner: root
    group: root
    mode: '0755'
  notify: Restart dell-fan-control

- name: Deploy Dell fan control systemd service
  ansible.builtin.template:
    src: dell-fan-control.service.j2
    dest: /etc/systemd/system/dell-fan-control.service
    owner: root
    group: root
    mode: '0644'
  notify: Restart dell-fan-control

- name: Enable and start Dell fan control service
  ansible.builtin.systemd:
    name: dell-fan-control
    enabled: true
    state: started
    daemon_reload: true
