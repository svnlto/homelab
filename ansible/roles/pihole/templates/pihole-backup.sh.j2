#!/bin/bash
# Pi-hole Configuration Backup Script

BACKUP_DIR="{{ backup_location }}"
TIMESTAMP=$(date +%Y%m%d-%H%M%S)
BACKUP_FILE="$BACKUP_DIR/pihole-backup-$TIMESTAMP.tar.gz"

mkdir -p "$BACKUP_DIR"

echo "Backing up Pi-hole configuration..."
tar -czf "$BACKUP_FILE" -C {{ pihole_base_dir }} etc-pihole etc-dnsmasq.d docker-compose.yml

echo "Backup created: $BACKUP_FILE"
echo "Size: $(du -h "$BACKUP_FILE" | cut -f1)"

# Keep only last {{ backup_retention_days }} backups
find "$BACKUP_DIR" -name "pihole-backup-*.tar.gz" -mtime +{{ backup_retention_days }} -delete

echo "Backup complete."
