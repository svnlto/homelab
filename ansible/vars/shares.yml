---
# TrueNAS NFS and SMB Share Configurations
# Hardware: R730xd (din) with 3 pools (bulk, fast, scratch)
# Based on: docs/truenas-ansible-setup.md

# ==============================================================================
# NFS SHARES
# ==============================================================================

nfs_shares:
  # ---------------------------------------------------------------------------
  # BULK POOL - Large files, media, photos
  # ---------------------------------------------------------------------------
  - path: /mnt/bulk/media
    comment: "Media + downloads for arr-stack (hardlinks require single dataset)"
    mapall_user: media
    mapall_group: media
    networks:
      - 10.10.10.0/24 # Storage VLAN (primary)
      - 192.168.0.0/24 # LAN (arr-stack)
      - 10.0.1.0/24 # K8s VLAN 30 (if Jellyfin runs on k8s)
      - 10.0.2.0/24 # K8s VLAN 31
    ro: false # Read-write: arr apps hardlink downloads â†’ media libraries

  # Child ZFS datasets need their own NFS shares (NFS can't cross dataset boundaries)
  - path: /mnt/bulk/media/movies
    comment: "Movies library (child dataset)"
    mapall_user: media
    mapall_group: media
    networks:
      - 10.10.10.0/24 # Storage VLAN (primary)
      - 192.168.0.0/24 # LAN (arr-stack)
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
    ro: false

  - path: /mnt/bulk/media/tv
    comment: "TV library (child dataset)"
    mapall_user: media
    mapall_group: media
    networks:
      - 10.10.10.0/24 # Storage VLAN (primary)
      - 192.168.0.0/24 # LAN (arr-stack)
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
    ro: false

  - path: /mnt/bulk/media/music
    comment: "Music library (child dataset)"
    mapall_user: media
    mapall_group: media
    networks:
      - 10.10.10.0/24 # Storage VLAN (primary)
      - 192.168.0.0/24 # LAN (arr-stack)
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
    ro: false

  - path: /mnt/bulk/media/books
    comment: "Books library (child dataset)"
    mapall_user: media
    mapall_group: media
    networks:
      - 10.10.10.0/24 # Storage VLAN (primary)
      - 192.168.0.0/24 # LAN (arr-stack)
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
    ro: false

  - path: /mnt/bulk/photos
    comment: "Photos for Immich"
    mapall_user: immich
    mapall_group: immich
    networks:
      - 10.10.10.0/24 # Storage VLAN (primary)
      - 192.168.0.0/24 # LAN (Immich)
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
    ro: false

  - path: /mnt/bulk/kubernetes/nfs-dynamic
    comment: "democratic-csi bulk pool (Forgejo registry, large app data)"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
      - 10.0.3.0/24 # K8s VLAN 32 (test)
    ro: false

  - path: /mnt/bulk/signoz-cold
    comment: "Signoz cold storage (30+ days)"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
    ro: false

  # ---------------------------------------------------------------------------
  # FAST POOL - Hot data, K8s, VMs, arr config
  # ---------------------------------------------------------------------------
  # TODO: Move to /mnt/fast/arr-config once MD1220 hardware arrives
  - path: /mnt/bulk/arr-config
    comment: "Arr stack configuration data (databases, settings)"
    mapall_user: media
    mapall_group: media
    networks:
      - 192.168.0.0/24 # LAN (arr-stack VM)
    ro: false

  - path: /mnt/fast/kubernetes/nfs-dynamic
    comment: "democratic-csi NFS dynamic provisioning"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
      - 10.0.3.0/24 # K8s VLAN 32 (test)
    ro: false

  - path: /mnt/fast/kubernetes/nfs-static
    comment: "Static PVs for shared configs"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
      - 10.0.3.0/24 # K8s VLAN 32 (test)
    ro: false

  # ---------------------------------------------------------------------------
  # SCRATCH POOL - Ephemeral data, downloads, CI cache
  # ---------------------------------------------------------------------------
  - path: /mnt/scratch/kubernetes/nfs-dynamic
    comment: "democratic-csi scratch pool (CI cache, ephemeral data)"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
      - 10.0.3.0/24 # K8s VLAN 32 (test)
    ro: false

  - path: /mnt/scratch/downloads/incomplete
    comment: "Active/incomplete downloads (temp staging, sync=disabled)"
    mapall_user: media
    mapall_group: media
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 192.168.0.0/24 # LAN (arr-stack)
    ro: false

  - path: /mnt/scratch/ci-runners
    comment: "Forgejo CI runner cache and artifacts"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
    ro: false

# SMB Shares
smb_shares:
  - name: TimeMachine
    path: /mnt/bulk/backups/timemachine
    purpose: ENHANCED_TIMEMACHINE
    comment: "macOS Time Machine backups"

  - name: Archive
    path: /mnt/bulk/archive
    purpose: DEFAULT_SHARE
    comment: "Manual file archive"

# Users and Groups
storage_users:
  - name: media
    uid: 1000
    gid: 1000
    group: media
    home: /nonexistent
    shell: /usr/sbin/nologin

  - name: immich
    uid: 1001
    gid: 1001
    group: immich
    home: /nonexistent
    shell: /usr/sbin/nologin

storage_groups:
  - name: media
    gid: 1000

  - name: immich
    gid: 1001
