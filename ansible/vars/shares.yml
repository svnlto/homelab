---
# TrueNAS NFS and SMB Share Configurations
# Hardware: R730xd (din) with 3 pools (bulk, fast, scratch)
# Based on: docs/truenas-ansible-setup.md

# ==============================================================================
# NFS SHARES
# ==============================================================================

nfs_shares:
  # ---------------------------------------------------------------------------
  # BULK POOL - Large files, media, photos
  # ---------------------------------------------------------------------------
  - path: /mnt/bulk/media
    comment: "Media for Jellyfin on arr-stack (ReadOnlyMany)"
    mapall_user: media
    mapall_group: media
    networks:
      - 10.10.10.0/24 # Storage VLAN (primary)
      - 192.168.0.0/24 # LAN (arr-stack)
      - 10.0.1.0/24 # K8s VLAN 30 (if Jellyfin runs on k8s)
      - 10.0.2.0/24 # K8s VLAN 31
    ro: true # Media is read-only for streaming

  - path: /mnt/bulk/photos
    comment: "Photos for Immich"
    mapall_user: immich
    mapall_group: immich
    networks:
      - 10.10.10.0/24 # Storage VLAN (primary)
      - 192.168.0.0/24 # LAN (Immich)
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
    ro: false

  - path: /mnt/bulk/kubernetes/nfs-dynamic
    comment: "democratic-csi bulk pool (Forgejo registry, large app data)"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
      - 10.0.3.0/24 # K8s VLAN 32 (test)
    ro: false

  - path: /mnt/bulk/signoz-cold
    comment: "Signoz cold storage (30+ days)"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
    ro: false

  # ---------------------------------------------------------------------------
  # FAST POOL - Hot data, K8s, VMs
  # ---------------------------------------------------------------------------
  - path: /mnt/fast/kubernetes/nfs-dynamic
    comment: "democratic-csi NFS dynamic provisioning"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
      - 10.0.3.0/24 # K8s VLAN 32 (test)
    ro: false

  - path: /mnt/fast/kubernetes/nfs-static
    comment: "Static PVs for shared configs"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
      - 10.0.3.0/24 # K8s VLAN 32 (test)
    ro: false

  # ---------------------------------------------------------------------------
  # SCRATCH POOL - Ephemeral data, downloads, CI cache
  # ---------------------------------------------------------------------------
  - path: /mnt/scratch/kubernetes/nfs-dynamic
    comment: "democratic-csi scratch pool (CI cache, ephemeral data)"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
      - 10.0.3.0/24 # K8s VLAN 32 (test)
    ro: false

  - path: /mnt/scratch/downloads
    comment: "Torrent/Usenet download staging"
    mapall_user: media
    mapall_group: media
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 192.168.0.0/24 # LAN (arr-stack)
    ro: false

  - path: /mnt/scratch/ci-runners
    comment: "Forgejo CI runner cache and artifacts"
    maproot_user: root
    maproot_group: wheel
    networks:
      - 10.10.10.0/24 # Storage VLAN
      - 10.0.1.0/24 # K8s VLAN 30
      - 10.0.2.0/24 # K8s VLAN 31
    ro: false

# SMB Shares
smb_shares:
  - name: TimeMachine
    path: /mnt/bulk/backups/timemachine
    purpose: TIMEMACHINE
    comment: "macOS Time Machine backups"

  - name: Archive
    path: /mnt/bulk/archive
    purpose: DEFAULT_SHARE
    comment: "Manual file archive"

# Users and Groups
storage_users:
  - name: media
    uid: 1000
    gid: 1000
    group: media
    home: /nonexistent
    shell: /usr/sbin/nologin

  - name: immich
    uid: 1001
    gid: 1001
    group: immich
    home: /nonexistent
    shell: /usr/sbin/nologin

storage_groups:
  - name: media
    gid: 1000

  - name: immich
    gid: 1001
