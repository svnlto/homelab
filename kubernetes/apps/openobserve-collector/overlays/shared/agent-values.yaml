---
# OTel Collector Agent (DaemonSet)
# Collects pod logs, host metrics, and kubelet metrics per node.
# Exports to OpenObserve via OTLP HTTP.

image:
  repository: otel/opentelemetry-collector-contrib

mode: daemonset

presets:
  logsCollection:
    enabled: true
  hostMetrics:
    enabled: true
  kubeletMetrics:
    enabled: true
  kubernetesAttributes:
    enabled: true

extraEnvFrom:
  - secretRef:
      name: openobserve-auth

resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    memory: 256Mi

config:
  exporters:
    otlphttp/openobserve:
      endpoint: http://openobserve-openobserve-standalone.openobserve.svc:5080/api/default/
      headers:
        Authorization: "${env:auth-header}"
  service:
    pipelines:
      logs:
        exporters:
          - otlphttp/openobserve
      metrics:
        exporters:
          - otlphttp/openobserve
      traces:
        exporters:
          - otlphttp/openobserve
