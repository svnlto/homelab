---
apiVersion: v1
kind: ConfigMap
metadata:
  name: buildarr-config
data:
  buildarr.yml.tmpl: |
    buildarr:
      watch_config: false
      update_days:
        - monday
      update_times:
        - "03:00"

    radarr:
      hostname: radarr.arr-stack.svc
      port: 7878
      protocol: http
      api_key: __RADARR_API_KEY__

      settings:
        media_management:
          rename_movies: true
          replace_illegal_characters: true
          standard_movie_format: "{Movie Title} ({Release Year}) {Quality Full}"
          movie_folder_format: "{Movie Title} ({Release Year})"

        download_clients:
          enable_completed_download_handling: true
          redownload_failed: true

    sonarr:
      hostname: sonarr.arr-stack.svc
      port: 8989
      protocol: http
      api_key: __SONARR_API_KEY__

      settings:
        media_management:
          rename_episodes: true
          replace_illegal_characters: true
          standard_episode_format: "{Series Title} - S{season:00}E{episode:00} - {Episode Title} {Quality Full}"
          series_folder_format: "{Series Title}"
          season_folder_format: "Season {season}"

        download_clients:
          enable_completed_download_handling: true
          redownload_failed: true

    lidarr:
      hostname: lidarr.arr-stack.svc
      port: 8686
      protocol: http
      api_key: __LIDARR_API_KEY__

      settings:
        media_management:
          rename_tracks: true
          replace_illegal_characters: true
          standard_track_format: "{Album Title} ({Release Year})/{Artist Name} - {Album Title} - {track:00} - {Track Title}"
          multi_disc_track_format: "{Album Title} ({Release Year})/{Medium Format} {medium:00}/{Artist Name} - {Album Title} - {track:00} - {Track Title}"
          artist_folder_format: "{Artist Name}"

        download_clients:
          enable_completed_download_handling: true
          redownload_failed: true

    bazarr:
      hostname: bazarr.arr-stack.svc
      port: 6767
      protocol: http
      api_key: __BAZARR_API_KEY__

    prowlarr:
      hostname: downloaders.arr-stack.svc
      port: 9696
      protocol: http
      api_key: __PROWLARR_API_KEY__

  entrypoint.sh: |
    #!/bin/sh
    set -e
    cp /config/buildarr.yml.tmpl /config/buildarr.yml
    sed -i "s/__RADARR_API_KEY__/$RADARR_API_KEY/g" /config/buildarr.yml
    sed -i "s/__SONARR_API_KEY__/$SONARR_API_KEY/g" /config/buildarr.yml
    sed -i "s/__PROWLARR_API_KEY__/$PROWLARR_API_KEY/g" /config/buildarr.yml
    sed -i "s/__LIDARR_API_KEY__/$LIDARR_API_KEY/g" /config/buildarr.yml
    sed -i "s/__BAZARR_API_KEY__/$BAZARR_API_KEY/g" /config/buildarr.yml
    exec "$@"
