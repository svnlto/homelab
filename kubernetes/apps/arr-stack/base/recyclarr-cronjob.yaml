---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: recyclarr
spec:
  schedule: "0 4 * * 1"
  concurrencyPolicy: Forbid
  startingDeadlineSeconds: 300
  jobTemplate:
    spec:
      activeDeadlineSeconds: 600
      backoffLimit: 1
      template:
        metadata:
          labels:
            app.kubernetes.io/name: recyclarr
        spec:
          restartPolicy: Never
          containers:
            - name: recyclarr
              image: ghcr.io/recyclarr/recyclarr:8.2.1
              command:
                - recyclarr
                - sync
              env:
                - name: TZ
                  value: Europe/Berlin
                - name: RADARR_API_KEY
                  valueFrom:
                    secretKeyRef:
                      name: arr-secrets
                      key: RADARR_API_KEY
                - name: SONARR_API_KEY
                  valueFrom:
                    secretKeyRef:
                      name: arr-secrets
                      key: SONARR_API_KEY
              resources:
                requests:
                  cpu: 25m
                  memory: 64Mi
                limits:
                  cpu: 200m
                  memory: 256Mi
              volumeMounts:
                - name: config
                  mountPath: /config
                - name: recyclarr-yml
                  mountPath: /config/recyclarr.yml
                  subPath: recyclarr.yml
                  readOnly: true
          volumes:
            - name: config
              persistentVolumeClaim:
                claimName: recyclarr-config
            - name: recyclarr-yml
              configMap:
                name: recyclarr-config
