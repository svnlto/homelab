---
# Traefik Helm Chart Values
# Install with:
# helm repo add traefik https://traefik.github.io/charts
# helm repo update
# helm install traefik traefik/traefik -n traefik --create-namespace -f traefik-values.yaml

# Deployment configuration
deployment:
  enabled: true
  kind: Deployment
  replicas: 2

# Service configuration
service:
  enabled: true
  type: LoadBalancer
  annotations: {}
  # Use MetalLB to assign external IP
  spec:
    externalTrafficPolicy: Local

# Ports configuration
ports:
  web:
    port: 80
    expose:
      default: true
    exposedPort: 80
    protocol: TCP
  websecure:
    port: 443
    expose:
      default: true
    exposedPort: 443
    protocol: TCP
    tls:
      enabled: true
  metrics:
    port: 9100
    expose:
      default: false
    protocol: TCP

# Enable dashboard
ingressRoute:
  dashboard:
    enabled: true
    # Secure the dashboard with basic auth or disable in production
    matchRule: Host(`traefik.local`)
    entryPoints: ["websecure"]

# Resource limits for ARM64
resources:
  requests:
    cpu: "100m"
    memory: "128Mi"
  limits:
    cpu: "500m"
    memory: "512Mi"

# Persistence for ACME certificates
persistence:
  enabled: true
  name: traefik-certs
  size: 128Mi
  path: /data
  storageClass: longhorn

# Enable access logs
logs:
  general:
    level: INFO
  access:
    enabled: true

# Enable Prometheus metrics
metrics:
  prometheus:
    enabled: true
    entryPoint: metrics

# Additional arguments
additionalArguments:
  - "--providers.kubernetesingress.ingressclass=traefik"
  - "--providers.kubernetescrd.allowCrossNamespace=true"
  - "--certificatesresolvers.letsencrypt.acme.email=your-email@example.com"
  - "--certificatesresolvers.letsencrypt.acme.storage=/data/acme.json"
  - "--certificatesresolvers.letsencrypt.acme.tlschallenge=true"

# Security context for ARM64
securityContext:
  capabilities:
    drop: [ALL]
    add: [NET_BIND_SERVICE]
  readOnlyRootFilesystem: true
  runAsGroup: 65532
  runAsNonRoot: true
  runAsUser: 65532

podSecurityContext:
  fsGroup: 65532
